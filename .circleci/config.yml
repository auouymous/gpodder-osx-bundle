# :noTabs=true:mode=yaml:tabSize=2:indentSize=2:
version: 2
jobs:
  build-and-bundle:
    macos:
      xcode: "9.2.0"
    shell: /bin/bash --login -o pipefail
    steps:
      - checkout
      - run: ./bootstrap.sh
      - run: ./build.sh
      - run: ./bundle.sh
      - run: ./release.sh _build/gPodder.app 3.10.x
  store:
    macos:
      xcode: "9.2.0"
    shell: /bin/bash --login -o pipefail
    steps:
      - store_artifacts:
          path: /Users/distiller/project/_build
  upload:
    macos:
      xcode: "9.2.0"
    shell: /bin/bash --login -o pipefail
    steps:
      - run: echo "$SSH_KEY" > /Users/distiller/project/gpodderbuild
      - run: chmod go-rwx /Users/distiller/project/gpodderbuild
      - run: rsync -e "ssh -p$RSYNC_PORT -i /Users/distiller/project/gpodderbuild -o StrictHostKeyChecking=no" -avrz "_home" "_build" "$RSYNC_HOME/$CIRCLE_BUILD_NUM/"
      - run: rm /Users/distiller/project/gpodderbuild
  dummy:
    macos:
      xcode: "9.2.0"
    shell: /bin/bash --login -o pipefail
    steps:
     - checkout
     - run: ./bootstrap.sh

workflows:
  version: 2
  build-bundle:
    jobs:
      - dummy
      - upload
